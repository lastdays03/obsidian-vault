---
tags:
  - knowledge/topic
Source: [[GitHub_Study_Python]]
---

# íŒŒì´ì¬ ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €(Context Manager) ì™„ì „ ê°€ì´ë“œ

## ğŸ“– ì •ì˜ (Definition)
**ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €(Context Manager)**ëŠ” `with` ë¬¸ê³¼ í•¨ê»˜ ì‚¬ìš©ë˜ì–´ ë¦¬ì†ŒìŠ¤(íŒŒì¼, ë„¤íŠ¸ì›Œí¬ ì—°ê²°, ë½ ë“±)ì˜ í• ë‹¹ê³¼ í•´ì œë¥¼ ìë™ìœ¼ë¡œ ê´€ë¦¬í•´ì£¼ëŠ” ê°ì²´ì…ë‹ˆë‹¤. ì˜ˆì™¸ê°€ ë°œìƒí•˜ë”ë¼ë„ ë¦¬ì†ŒìŠ¤ê°€ ì•ˆì „í•˜ê²Œ ì •ë¦¬ë˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤.

---

## ëª©ì°¨

1. [ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €ë€?](#1-ì»¨í…ìŠ¤íŠ¸-ë§¤ë‹ˆì €ë€)
2. [with ë¬¸ ê¸°ë³¸ ì‚¬ìš©ë²•](#2-with-ë¬¸-ê¸°ë³¸-ì‚¬ìš©ë²•)
3. [ì»¤ìŠ¤í…€ ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €](#3-ì»¤ìŠ¤í…€-ì»¨í…ìŠ¤íŠ¸-ë§¤ë‹ˆì €)
4. [contextlib ëª¨ë“ˆ](#4-contextlib-ëª¨ë“ˆ)
5. [ì¤‘ì²© ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €](#5-ì¤‘ì²©-ì»¨í…ìŠ¤íŠ¸-ë§¤ë‹ˆì €)
6. [ì‹¤ì „ ì˜ˆì œ](#6-ì‹¤ì „-ì˜ˆì œ)
7. [ì£¼ì˜ì‚¬í•­](#7-ì£¼ì˜ì‚¬í•­)
8. [ìš”ì•½](#8-ìš”ì•½)

---

## 1. ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €ë€?

### 1.1 ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €ì˜ ê°œë…

**ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €(Context Manager)**ëŠ” `with` ë¬¸ê³¼ í•¨ê»˜ ì‚¬ìš©ë˜ì–´ ë¦¬ì†ŒìŠ¤ë¥¼ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•˜ëŠ” ê°ì²´ì…ë‹ˆë‹¤.

```python
# íŒŒì¼ ì²˜ë¦¬ ì˜ˆì œ
with open('file.txt', 'r') as f:
    content = f.read()
# íŒŒì¼ì´ ìë™ìœ¼ë¡œ ë‹«í˜
```

### 1.2 ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €ì˜ ì¥ì 

- **ìë™ ë¦¬ì†ŒìŠ¤ ì •ë¦¬**: `finally` ë¸”ë¡ ë¶ˆí•„ìš”
- **ì˜ˆì™¸ ì•ˆì „ì„±**: ì˜ˆì™¸ ë°œìƒ ì‹œì—ë„ ì •ë¦¬ ë³´ì¥
- **ì½”ë“œ ê°„ê²°ì„±**: ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œ ê°ì†Œ

## 2. with ë¬¸ ê¸°ë³¸ ì‚¬ìš©ë²•

### 2.1 íŒŒì¼ ì²˜ë¦¬

```python
# ê¸°ë³¸ ì‚¬ìš©ë²•
with open('file.txt', 'r') as f:
    content = f.read()
    # íŒŒì¼ì´ ìë™ìœ¼ë¡œ ë‹«í˜

# ì—¬ëŸ¬ íŒŒì¼ ë™ì‹œ ì²˜ë¦¬
with open('input.txt', 'r') as infile, open('output.txt', 'w') as outfile:
    data = infile.read()
    outfile.write(data)
```

### 2.2 ì˜ˆì™¸ ì²˜ë¦¬ì™€ ë¹„êµ

```python
# ì „í†µì ì¸ ë°©ë²• (finally í•„ìš”)
file = open('file.txt', 'r')
try:
    content = file.read()
finally:
    file.close()

# with ë¬¸ ì‚¬ìš© (ê°„ê²°í•¨)
with open('file.txt', 'r') as file:
    content = file.read()
```

## 3. ì»¤ìŠ¤í…€ ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €

### 3.1 í´ë˜ìŠ¤ ê¸°ë°˜ ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €

```python
class FileManager:
    def __init__(self, filename, mode):
        self.filename = filename
        self.mode = mode
        self.file = None
    
    def __enter__(self):
        """with ë¬¸ ì§„ì… ì‹œ ì‹¤í–‰"""
        self.file = open(self.filename, self.mode)
        return self.file
    
    def __exit__(self, exc_type, exc_val, exc_tb):
        """with ë¬¸ ì¢…ë£Œ ì‹œ ì‹¤í–‰"""
        if self.file:
            self.file.close()
        return False  # ì˜ˆì™¸ë¥¼ ì „íŒŒí•˜ì§€ ì•ŠìŒ

# ì‚¬ìš©
with FileManager('file.txt', 'r') as f:
    content = f.read()
```

### 3.2 íƒ€ì´ë¨¸ ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €

```python
import time

class Timer:
    def __enter__(self):
        self.start = time.time()
        return self
    
    def __exit__(self, exc_type, exc_val, exc_tb):
        self.end = time.time()
        print(f"ì‹¤í–‰ ì‹œê°„: {self.end - self.start:.2f}ì´ˆ")
        return False

# ì‚¬ìš©
with Timer():
    time.sleep(1)
    # ì‹¤í–‰ ì‹œê°„: 1.00ì´ˆ
```

### 3.3 ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ê´€ë¦¬

```python
class DatabaseConnection:
    def __init__(self, db_url):
        self.db_url = db_url
        self.conn = None
    
    def __enter__(self):
        self.conn = connect(self.db_url)
        return self.conn
    
    def __exit__(self, exc_type, exc_val, exc_tb):
        if self.conn:
            self.conn.close()
        return False

# ì‚¬ìš©
with DatabaseConnection('sqlite:///db.sqlite') as conn:
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM users")
```

## 4. contextlib ëª¨ë“ˆ

### 4.1 @contextmanager ë°ì½”ë ˆì´í„°

```python
from contextlib import contextmanager

@contextmanager
def file_manager(filename, mode):
    """ì œë„ˆë ˆì´í„° ê¸°ë°˜ ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €"""
    file = open(filename, mode)
    try:
        yield file
    finally:
        file.close()

# ì‚¬ìš©
with file_manager('file.txt', 'r') as f:
    content = f.read()
```

### 4.2 íƒ€ì´ë¨¸ ì˜ˆì œ

```python
from contextlib import contextmanager
import time

@contextmanager
def timer():
    start = time.time()
    try:
        yield
    finally:
        end = time.time()
        print(f"ì‹¤í–‰ ì‹œê°„: {end - start:.2f}ì´ˆ")

# ì‚¬ìš©
with timer():
    time.sleep(1)
```

### 4.3 ì„ì‹œ ë””ë ‰í† ë¦¬ ë³€ê²½

```python
from contextlib import contextmanager
import os

@contextmanager
def change_directory(path):
    """ì„ì‹œë¡œ ì‘ì—… ë””ë ‰í† ë¦¬ ë³€ê²½"""
    old_path = os.getcwd()
    try:
        os.chdir(path)
        yield
    finally:
        os.chdir(old_path)

# ì‚¬ìš©
with change_directory('/tmp'):
    print(os.getcwd())  # /tmp
print(os.getcwd())  # ì›ë˜ ê²½ë¡œ
```

### 4.4 redirect_stdout

```python
from contextlib import redirect_stdout
import io

# ì¶œë ¥ì„ ìº¡ì²˜
f = io.StringIO()
with redirect_stdout(f):
    print("ì´ ë©”ì‹œì§€ëŠ” ìº¡ì²˜ë¨")

captured = f.getvalue()
print(f"ìº¡ì²˜ëœ ë‚´ìš©: {captured}")
```

## 5. ì¤‘ì²© ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €

### 5.1 ì—¬ëŸ¬ ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €

```python
# ì—¬ëŸ¬ íŒŒì¼ ë™ì‹œ ì²˜ë¦¬
with open('input.txt', 'r') as infile, \
     open('output.txt', 'w') as outfile, \
     timer():
    data = infile.read()
    outfile.write(data)
```

### 5.2 ExitStack

```python
from contextlib import ExitStack

with ExitStack() as stack:
    files = [stack.enter_context(open(fname)) for fname in filenames]
    # ëª¨ë“  íŒŒì¼ì´ ìë™ìœ¼ë¡œ ë‹«í˜
```

## 6. ì‹¤ì „ ì˜ˆì œ

### 6.1 íŠ¸ëœì­ì…˜ ê´€ë¦¬

```python
@contextmanager
def transaction(db):
    """ë°ì´í„°ë² ì´ìŠ¤ íŠ¸ëœì­ì…˜"""
    db.begin()
    try:
        yield
        db.commit()
    except Exception:
        db.rollback()
        raise

# ì‚¬ìš©
with transaction(db):
    db.execute("INSERT INTO users ...")
    db.execute("UPDATE accounts ...")
```

### 6.2 ì„ì‹œ ì„¤ì • ë³€ê²½

```python
@contextmanager
def temporary_setting(obj, attr, value):
    """ì„ì‹œë¡œ ì†ì„± ë³€ê²½"""
    old_value = getattr(obj, attr)
    try:
        setattr(obj, attr, value)
        yield
    finally:
        setattr(obj, attr, old_value)

# ì‚¬ìš©
with temporary_setting(config, 'debug', True):
    # debug ëª¨ë“œë¡œ ì‹¤í–‰
    pass
# ì›ë˜ ì„¤ì •ìœ¼ë¡œ ë³µì›
```

## 7. ì£¼ì˜ì‚¬í•­

### 7.1 ì˜ˆì™¸ ì²˜ë¦¬

```python
class MyContext:
    def __enter__(self):
        return self
    
    def __exit__(self, exc_type, exc_val, exc_tb):
        # exc_type: ì˜ˆì™¸ íƒ€ì…
        # exc_val: ì˜ˆì™¸ ê°’
        # exc_tb: íŠ¸ë ˆì´ìŠ¤ë°±
        if exc_type is not None:
            print(f"ì˜ˆì™¸ ë°œìƒ: {exc_type.__name__}")
        return False  # ì˜ˆì™¸ë¥¼ ì „íŒŒ

# Trueë¥¼ ë°˜í™˜í•˜ë©´ ì˜ˆì™¸ê°€ ì–µì œë¨
```

## 8. ìš”ì•½

### í•µì‹¬ ê°œë…

1. **ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì €**: ë¦¬ì†ŒìŠ¤ë¥¼ ì•ˆì „í•˜ê²Œ ê´€ë¦¬
2. **with ë¬¸**: ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì € ì‚¬ìš©
3. **__enter__/__exit__**: ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì € í”„ë¡œí† ì½œ
4. **contextlib**: ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì œê³µ

### ì£¼ìš” ì‚¬ìš© ì‚¬ë¡€

- íŒŒì¼ ì²˜ë¦¬
- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
- ë½(Lock) ê´€ë¦¬
- ì„ì‹œ ì„¤ì • ë³€ê²½
- íƒ€ì´ë° ì¸¡ì •

### ëª¨ë²” ì‚¬ë¡€

- âœ… ë¦¬ì†ŒìŠ¤ ì •ë¦¬ëŠ” `__exit__`ì—ì„œ
- âœ… ì˜ˆì™¸ ì²˜ë¦¬ ê³ ë ¤
- âœ… `contextlib` í™œìš©
- âœ… ëª…í™•í•œ ì´ë¦„ ì‚¬ìš©

